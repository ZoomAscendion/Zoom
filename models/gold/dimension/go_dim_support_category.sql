{{ config(
    materialized='table'
) }}

-- Support Category Dimension Table
WITH support_data AS (
    SELECT 'Technical' AS TICKET_TYPE
    UNION ALL SELECT 'Billing'
    UNION ALL SELECT 'Feature Request'
    UNION ALL SELECT 'Account'
    UNION ALL SELECT 'Critical'
    UNION ALL SELECT 'High'
    UNION ALL SELECT 'Medium'
    UNION ALL SELECT 'Low'
)
SELECT 
    ROW_NUMBER() OVER (ORDER BY TICKET_TYPE) AS SUPPORT_CATEGORY_ID,
    TICKET_TYPE AS SUPPORT_CATEGORY,
    CASE 
        WHEN UPPER(TICKET_TYPE) LIKE '%TECHNICAL%' THEN 'Technical'
        WHEN UPPER(TICKET_TYPE) LIKE '%BILLING%' THEN 'Billing'
        WHEN UPPER(TICKET_TYPE) LIKE '%FEATURE%' THEN 'Feature Request'
        WHEN UPPER(TICKET_TYPE) LIKE '%ACCOUNT%' THEN 'Account'
        WHEN UPPER(TICKET_TYPE) LIKE '%CRITICAL%' THEN 'Critical Issue'
        WHEN UPPER(TICKET_TYPE) LIKE '%HIGH%' THEN 'High Priority'
        WHEN UPPER(TICKET_TYPE) LIKE '%MEDIUM%' THEN 'Medium Priority'
        WHEN UPPER(TICKET_TYPE) LIKE '%LOW%' THEN 'Low Priority'
        ELSE 'General'
    END AS SUPPORT_SUBCATEGORY,
    CASE 
        WHEN UPPER(TICKET_TYPE) LIKE '%CRITICAL%' THEN 'Critical'
        WHEN UPPER(TICKET_TYPE) LIKE '%HIGH%' THEN 'High'
        WHEN UPPER(TICKET_TYPE) LIKE '%MEDIUM%' THEN 'Medium'
        ELSE 'Low'
    END AS PRIORITY_LEVEL,
    CASE 
        WHEN UPPER(TICKET_TYPE) LIKE '%CRITICAL%' THEN 4
        WHEN UPPER(TICKET_TYPE) LIKE '%HIGH%' THEN 24
        WHEN UPPER(TICKET_TYPE) LIKE '%MEDIUM%' THEN 72
        ELSE 168
    END AS EXPECTED_RESOLUTION_HOURS,
    CASE 
        WHEN UPPER(TICKET_TYPE) LIKE '%CRITICAL%' OR UPPER(TICKET_TYPE) LIKE '%HIGH%' THEN TRUE
        ELSE FALSE
    END AS REQUIRES_ESCALATION,
    CASE 
        WHEN UPPER(TICKET_TYPE) LIKE '%LOW%' OR UPPER(TICKET_TYPE) LIKE '%MEDIUM%' THEN TRUE
        ELSE FALSE
    END AS SELF_SERVICE_AVAILABLE,
    CASE 
        WHEN UPPER(TICKET_TYPE) LIKE '%CRITICAL%' OR UPPER(TICKET_TYPE) LIKE '%TECHNICAL%' THEN TRUE
        ELSE FALSE
    END AS SPECIALIST_REQUIRED,
    CASE 
        WHEN UPPER(TICKET_TYPE) LIKE '%CRITICAL%' THEN 'High'
        WHEN UPPER(TICKET_TYPE) LIKE '%HIGH%' OR UPPER(TICKET_TYPE) LIKE '%TECHNICAL%' THEN 'Medium'
        ELSE 'Low'
    END AS CATEGORY_COMPLEXITY,
    CASE 
        WHEN UPPER(TICKET_TYPE) LIKE '%CRITICAL%' THEN 'Critical'
        WHEN UPPER(TICKET_TYPE) LIKE '%HIGH%' THEN 'High'
        WHEN UPPER(TICKET_TYPE) LIKE '%MEDIUM%' THEN 'Medium'
        ELSE 'Low'
    END AS CUSTOMER_IMPACT_LEVEL,
    CASE 
        WHEN UPPER(TICKET_TYPE) LIKE '%TECHNICAL%' THEN 'Technical Support'
        WHEN UPPER(TICKET_TYPE) LIKE '%BILLING%' THEN 'Account Management'
        ELSE 'Standard Support'
    END AS RESOLUTION_METHOD,
    CASE 
        WHEN UPPER(TICKET_TYPE) LIKE '%TECHNICAL%' THEN 25
        WHEN UPPER(TICKET_TYPE) LIKE '%FEATURE%' THEN 15
        WHEN UPPER(TICKET_TYPE) LIKE '%BILLING%' THEN 10
        ELSE 5
    END AS KNOWLEDGE_BASE_ARTICLES,
    CURRENT_DATE() AS LOAD_DATE,
    CURRENT_DATE() AS UPDATE_DATE,
    'SYSTEM' AS SOURCE_SYSTEM
FROM support_data
