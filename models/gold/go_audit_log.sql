{{ config(
    materialized='table',
    cluster_by=['EXECUTION_START_TIME', 'PIPELINE_NAME'],
    tags=['audit', 'infrastructure']
) }}

-- Audit log table for comprehensive pipeline execution tracking
-- This table must be created first and runs before any other models

WITH audit_structure AS (
    SELECT 
        CAST(NULL AS VARCHAR(255)) AS EXECUTION_ID,
        CAST(NULL AS VARCHAR(255)) AS PIPELINE_NAME,
        CAST(NULL AS VARCHAR(100)) AS PIPELINE_TYPE,
        CAST(NULL AS TIMESTAMP_NTZ(9)) AS EXECUTION_START_TIME,
        CAST(NULL AS TIMESTAMP_NTZ(9)) AS EXECUTION_END_TIME,
        CAST(NULL AS NUMBER(10,2)) AS EXECUTION_DURATION_SECONDS,
        CAST(NULL AS VARCHAR(50)) AS EXECUTION_STATUS,
        CAST(NULL AS VARCHAR(255)) AS SOURCE_TABLE,
        CAST(NULL AS VARCHAR(255)) AS TARGET_TABLE,
        CAST(NULL AS NUMBER(38,0)) AS RECORDS_PROCESSED,
        CAST(NULL AS NUMBER(38,0)) AS RECORDS_SUCCESS,
        CAST(NULL AS NUMBER(38,0)) AS RECORDS_FAILED,
        CAST(NULL AS NUMBER(38,0)) AS RECORDS_SKIPPED,
        CAST(NULL AS NUMBER(5,2)) AS DATA_QUALITY_SCORE_AVG,
        CAST(NULL AS NUMBER(38,0)) AS ERROR_COUNT,
        CAST(NULL AS NUMBER(38,0)) AS WARNING_COUNT,
        CAST(NULL AS VARCHAR(100)) AS EXECUTION_TRIGGER,
        CAST(NULL AS VARCHAR(255)) AS EXECUTED_BY,
        CAST(NULL AS VARIANT) AS CONFIGURATION_USED,
        CAST(NULL AS VARIANT) AS ERROR_DETAILS,
        CAST(NULL AS VARIANT) AS PERFORMANCE_METRICS,
        CAST(NULL AS TIMESTAMP_NTZ(9)) AS LOAD_TIMESTAMP,
        CAST(NULL AS TIMESTAMP_NTZ(9)) AS UPDATE_TIMESTAMP
    WHERE 1=0  -- This ensures no records are selected, creating empty structure
)

SELECT * FROM audit_structure
