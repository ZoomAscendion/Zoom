{{ config(
    materialized='table'
) }}

-- Audit log table for tracking all Gold layer transformations
WITH audit_structure AS (
    SELECT 
        'AUDIT_LOG_INIT_' || TO_CHAR(CURRENT_TIMESTAMP(), 'YYYYMMDDHH24MISS') AS PROCESS_ID,
        'AUDIT_LOG_INITIALIZATION' AS PROCESS_NAME,
        'SYSTEM' AS SOURCE_TABLE,
        'GO_AUDIT_LOG' AS TARGET_TABLE,
        CURRENT_TIMESTAMP() AS PROCESS_START_TIME,
        CURRENT_TIMESTAMP() AS PROCESS_END_TIME,
        'COMPLETED' AS PROCESS_STATUS,
        1 AS RECORDS_PROCESSED,
        1 AS RECORDS_SUCCESS,
        0 AS RECORDS_FAILED,
        CURRENT_TIMESTAMP() AS CREATED_AT,
        CURRENT_TIMESTAMP() AS UPDATED_AT
)
SELECT 
    PROCESS_ID::VARCHAR(255) AS PROCESS_ID,
    PROCESS_NAME::VARCHAR(255) AS PROCESS_NAME,
    SOURCE_TABLE::VARCHAR(255) AS SOURCE_TABLE,
    TARGET_TABLE::VARCHAR(255) AS TARGET_TABLE,
    PROCESS_START_TIME,
    PROCESS_END_TIME,
    PROCESS_STATUS::VARCHAR(50) AS PROCESS_STATUS,
    RECORDS_PROCESSED,
    RECORDS_SUCCESS,
    RECORDS_FAILED,
    CREATED_AT,
    UPDATED_AT
FROM audit_structure
