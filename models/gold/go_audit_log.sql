{{ config(
    materialized='table',
    pre_hook="",
    post_hook=""
) }}

-- Gold Layer Process Audit Log
-- This table must be created first to support audit logging for all other models

SELECT
    CAST(UUID_STRING() AS VARCHAR(255)) AS AUDIT_LOG_ID,
    CAST('INITIAL_SETUP' AS VARCHAR(255)) AS PROCESS_NAME,
    CAST('AUDIT_TABLE_CREATION' AS VARCHAR(100)) AS PROCESS_TYPE,
    CURRENT_TIMESTAMP() AS EXECUTION_START_TIMESTAMP,
    CURRENT_TIMESTAMP() AS EXECUTION_END_TIMESTAMP,
    CAST(0 AS NUMBER(15,2)) AS EXECUTION_DURATION_SECONDS,
    CAST('SUCCESS' AS VARCHAR(50)) AS EXECUTION_STATUS,
    CAST('SYSTEM' AS VARCHAR(255)) AS SOURCE_TABLE_NAME,
    CAST('GO_AUDIT_LOG' AS VARCHAR(255)) AS TARGET_TABLE_NAME,
    CAST(0 AS NUMBER(20,0)) AS RECORDS_READ,
    CAST(1 AS NUMBER(20,0)) AS RECORDS_PROCESSED,
    CAST(1 AS NUMBER(20,0)) AS RECORDS_INSERTED,
    CAST(0 AS NUMBER(20,0)) AS RECORDS_UPDATED,
    CAST(0 AS NUMBER(20,0)) AS RECORDS_FAILED,
    CAST(100.0 AS NUMBER(5,2)) AS DATA_QUALITY_SCORE,
    CAST(0 AS NUMBER(15,0)) AS ERROR_COUNT,
    CAST(0 AS NUMBER(15,0)) AS WARNING_COUNT,
    CAST('MANUAL' AS VARCHAR(100)) AS PROCESS_TRIGGER,
    CAST('DBT_SYSTEM' AS VARCHAR(100)) AS EXECUTED_BY,
    CAST('DBT_CLOUD' AS VARCHAR(100)) AS SERVER_NAME,
    CAST('1.0' AS VARCHAR(50)) AS PROCESS_VERSION,
    PARSE_JSON('{}') AS CONFIGURATION_PARAMETERS,
    PARSE_JSON('{}') AS PERFORMANCE_METRICS,
    CURRENT_DATE() AS LOAD_DATE,
    CURRENT_DATE() AS UPDATE_DATE,
    CAST('DBT_GOLD_LAYER' AS VARCHAR(100)) AS SOURCE_SYSTEM
WHERE FALSE -- This ensures no actual data is inserted during initial creation

UNION ALL

SELECT
    CAST(UUID_STRING() AS VARCHAR(255)) AS AUDIT_LOG_ID,
    CAST('AUDIT_LOG_INITIALIZATION' AS VARCHAR(255)) AS PROCESS_NAME,
    CAST('TABLE_INITIALIZATION' AS VARCHAR(100)) AS PROCESS_TYPE,
    CURRENT_TIMESTAMP() AS EXECUTION_START_TIMESTAMP,
    CURRENT_TIMESTAMP() AS EXECUTION_END_TIMESTAMP,
    CAST(1.0 AS NUMBER(15,2)) AS EXECUTION_DURATION_SECONDS,
    CAST('SUCCESS' AS VARCHAR(50)) AS EXECUTION_STATUS,
    CAST('DBT_SYSTEM' AS VARCHAR(255)) AS SOURCE_TABLE_NAME,
    CAST('GO_AUDIT_LOG' AS VARCHAR(255)) AS TARGET_TABLE_NAME,
    CAST(0 AS NUMBER(20,0)) AS RECORDS_READ,
    CAST(1 AS NUMBER(20,0)) AS RECORDS_PROCESSED,
    CAST(1 AS NUMBER(20,0)) AS RECORDS_INSERTED,
    CAST(0 AS NUMBER(20,0)) AS RECORDS_UPDATED,
    CAST(0 AS NUMBER(20,0)) AS RECORDS_FAILED,
    CAST(100.0 AS NUMBER(5,2)) AS DATA_QUALITY_SCORE,
    CAST(0 AS NUMBER(15,0)) AS ERROR_COUNT,
    CAST(0 AS NUMBER(15,0)) AS WARNING_COUNT,
    CAST('DBT_RUN' AS VARCHAR(100)) AS PROCESS_TRIGGER,
    CAST('DBT_SYSTEM' AS VARCHAR(100)) AS EXECUTED_BY,
    CAST('DBT_CLOUD' AS VARCHAR(100)) AS SERVER_NAME,
    CAST('1.0' AS VARCHAR(50)) AS PROCESS_VERSION,
    PARSE_JSON('{}') AS CONFIGURATION_PARAMETERS,
    PARSE_JSON('{}') AS PERFORMANCE_METRICS,
    CURRENT_DATE() AS LOAD_DATE,
    CURRENT_DATE() AS UPDATE_DATE,
    CAST('DBT_GOLD_LAYER' AS VARCHAR(100)) AS SOURCE_SYSTEM
